#!/usr/bin/env sh

set -e

prefix_default="/usr/local"
prefix_value="$prefix_default"

usage() {
	cat <<EOF
Usage: $0 [--prefix=PATH]

Options:
  --prefix=PATH   Installation prefix (default: $prefix_default)
  -h, --help      Show this help message
EOF
}

while [ "$#" -gt 0 ]; do
	case "$1" in
		--prefix=*)
			prefix_value="${1#*=}"
			if [ -z "$prefix_value" ]; then
				echo "error: --prefix requires a path" >&2
				exit 1
			fi
			;;
		--prefix)
			if [ -z "${2-}" ]; then
				echo "error: --prefix requires a path" >&2
				exit 1
			fi
			prefix_value="$2"
			shift
			;;
		-h|--help)
			usage
			exit 0
			;;
		*)
			echo "error: unknown option: $1" >&2
			usage
			exit 1
			;;
	esac
	shift
done

cat > config.mk <<EOF
# Generated by ./configure
PREFIX := $prefix_value
EOF

echo "Configured prefix: $prefix_value"
echo "Run 'make' to build and 'make install' to install."
